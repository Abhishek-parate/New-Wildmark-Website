# ============================================================
# WILDMARK RESORT — .htaccess (Performance + SEO Optimized)
# ============================================================

RewriteEngine On

# -----------------------------------------
# 1️⃣ Force specific 301 redirect (OLD → NEW)
# -----------------------------------------
RewriteRule ^kanha-holiday-tour-package/?$ https://wildmarkresort.com/kanha-tour-package/ [R=301,L]

# -----------------------------------------
# 2️⃣ Remove index.php from URL
# -----------------------------------------
RewriteCond %{THE_REQUEST} \s/index\.php[\s?]
RewriteRule ^index\.php$ / [R=301,L]

# -----------------------------------------
# 3️⃣ Redirect .php URLs to clean URLs
# -----------------------------------------
RewriteCond %{THE_REQUEST} \s/+(.+?)\.php[\s?]
RewriteRule ^ %1 [R=301,L]

# -----------------------------------------
# 4️⃣ Internally rewrite clean URLs to .php
# -----------------------------------------
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^([^/]+)/?$ $1.php [L]

# ============================================================
# 5️⃣ GZIP COMPRESSION — reduces transfer size by 60-80%
# ============================================================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE image/svg+xml
    AddOutputFilterByType DEFLATE font/ttf
    AddOutputFilterByType DEFLATE font/otf
    AddOutputFilterByType DEFLATE font/woff
    AddOutputFilterByType DEFLATE font/woff2
    # Remove browser bugs (only needed for old browsers)
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
    Header append Vary User-Agent
</IfModule>

# ============================================================
# 6️⃣ BROWSER CACHING — tells browsers to cache static files
# ============================================================
<IfModule mod_expires.c>
    ExpiresActive On

    # Images — cache for 1 year
    ExpiresByType image/jpg        "access plus 1 year"
    ExpiresByType image/jpeg       "access plus 1 year"
    ExpiresByType image/png        "access plus 1 year"
    ExpiresByType image/webp       "access plus 1 year"
    ExpiresByType image/gif        "access plus 1 year"
    ExpiresByType image/svg+xml    "access plus 1 year"
    ExpiresByType image/x-icon     "access plus 1 year"
    ExpiresByType image/ico        "access plus 1 year"

    # Video
    ExpiresByType video/mp4        "access plus 1 year"
    ExpiresByType video/webm       "access plus 1 year"

    # Fonts — cache for 1 year
    ExpiresByType font/ttf         "access plus 1 year"
    ExpiresByType font/otf         "access plus 1 year"
    ExpiresByType font/woff        "access plus 1 year"
    ExpiresByType font/woff2       "access plus 1 year"
    ExpiresByType application/font-woff  "access plus 1 year"

    # CSS & JS — cache for 1 month
    ExpiresByType text/css                "access plus 1 month"
    ExpiresByType text/javascript         "access plus 1 month"
    ExpiresByType application/javascript  "access plus 1 month"

    # HTML & PHP — cache for 1 day
    ExpiresByType text/html          "access plus 1 day"
    ExpiresByType application/xhtml+xml "access plus 1 day"

    # Default fallback
    ExpiresDefault "access plus 1 week"
</IfModule>

# ============================================================
# 7️⃣ CACHE-CONTROL HEADERS — fine-grained cache directives
# ============================================================
<IfModule mod_headers.c>
    # Long cache for static assets
    <FilesMatch "\.(ico|jpg|jpeg|png|webp|gif|svg|mp4|webm|woff|woff2|ttf|otf)$">
        Header set Cache-Control "max-age=31536000, public, immutable"
    </FilesMatch>
    # Medium cache for CSS & JS
    <FilesMatch "\.(css|js)$">
        Header set Cache-Control "max-age=2592000, public"
    </FilesMatch>
    # Short cache for HTML
    <FilesMatch "\.(html|php)$">
        Header set Cache-Control "max-age=86400, public, must-revalidate"
    </FilesMatch>
    # Security headers (bonus)
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ============================================================
# 8️⃣ KEEP-ALIVE — reuse connections for multiple requests
# ============================================================
<IfModule mod_headers.c>
    Header set Connection keep-alive
</IfModule>

# ============================================================
# 9️⃣ DISABLE ETAGS — avoid redundant validation
# ============================================================
<IfModule mod_headers.c>
    Header unset ETag
</IfModule>
FileETag None
